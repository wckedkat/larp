<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lar.p</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Cinzel+Decorative:wght@400;700;900&family=IM+Fell+English+SC&family=MedievalSharp&display=swap');

        * { margin:0; padding:0; box-sizing:border-box; }

        html, body {
            width: 100%; height: 100%;
            overflow: hidden;
            background: #000;
            cursor: none;
        }

        /* Custom cursor - small cross */
        .cursor {
            position: fixed;
            width: 16px; height: 16px;
            pointer-events: none;
            z-index: 999;
            transform: translate(-50%, -50%);
            opacity: 0.3;
            transition: opacity 0.3s;
        }
        .cursor::before, .cursor::after {
            content: '';
            position: absolute;
            background: rgba(200,180,150,0.5);
        }
        .cursor::before { width: 1px; height: 100%; left: 50%; }
        .cursor::after { width: 100%; height: 1px; top: 50%; }

        /* â”€â”€â”€ BACKGROUND â”€â”€â”€ */
        .bg {
            position: fixed; inset: 0; z-index: 0;
            background: #000;
        }

        canvas#mainCanvas {
            position: fixed; inset: 0; z-index: 5;
        }

        /* â”€â”€â”€ THE FLAME LETTER â”€â”€â”€ */
        .flame-stage {
            position: fixed; inset: 0; z-index: 20;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            pointer-events: none;
        }

        .flame-container {
            position: relative;
            display: flex; flex-direction: column;
            align-items: center;
        }

        /* Multiple L layers for flame effect */
        .flame-letter {
            font-family: 'UnifrakturMaguntia', cursive;
            font-size: clamp(150px, 24vw, 300px);
            line-height: 0.85;
            position: absolute;
            user-select: none;
            will-change: transform, opacity;
        }

        /* Core - bright golden white */
        .flame-core {
            color: rgba(255, 240, 200, 0.95);
            text-shadow: 0 0 5px rgba(255,230,180,0.8);
            z-index: 5;
        }

        /* Inner glow - warm gold */
        .flame-inner {
            color: rgba(255, 180, 60, 0.7);
            filter: blur(3px);
            z-index: 4;
            transform-origin: bottom center;
        }

        /* Mid glow - orange */
        .flame-mid {
            color: rgba(255, 120, 20, 0.5);
            filter: blur(8px);
            z-index: 3;
            transform-origin: bottom center;
        }

        /* Outer glow - deep red */
        .flame-outer {
            color: rgba(200, 40, 10, 0.35);
            filter: blur(16px);
            z-index: 2;
            transform-origin: bottom center;
        }

        /* Furthest glow - dark crimson haze */
        .flame-haze {
            color: rgba(120, 15, 5, 0.25);
            filter: blur(30px);
            z-index: 1;
            transform-origin: bottom center;
        }

        /* Letter placeholder for sizing */
        .flame-sizer {
            font-family: 'UnifrakturMaguntia', cursive;
            font-size: clamp(150px, 24vw, 300px);
            line-height: 0.85;
            color: transparent;
            position: relative;
        }

        /* Candle body below */
        .candle-body {
            position: relative;
            width: 40px;
            margin-top: -10px;
            z-index: 10;
        }

        .candle-stick {
            width: 30px; height: 100px;
            margin: 0 auto;
            background: linear-gradient(90deg,
                rgba(60,45,35,0.8) 0%,
                rgba(90,75,60,0.9) 30%,
                rgba(110,95,75,0.95) 50%,
                rgba(90,75,60,0.9) 70%,
                rgba(50,38,28,0.8) 100%
            );
            border-radius: 2px 2px 4px 4px;
            position: relative;
            overflow: visible;
            box-shadow:
                inset 0 0 10px rgba(0,0,0,0.3),
                0 0 20px rgba(100,50,20,0.1);
        }

        /* Wick */
        .wick {
            position: absolute;
            top: -12px; left: 50%;
            transform: translateX(-50%);
            width: 2px; height: 14px;
            background: linear-gradient(180deg, rgba(60,40,30,0.9), rgba(30,20,15,1));
            border-radius: 1px;
            animation: wickGlow 2s ease-in-out infinite;
        }
        .wick::after {
            content: '';
            position: absolute;
            top: -3px; left: -2px;
            width: 6px; height: 6px;
            background: rgba(255,200,100,0.9);
            border-radius: 50%;
            filter: blur(2px);
            animation: wickEmber 1.5s ease-in-out infinite;
        }
        @keyframes wickGlow {
            0%, 100% { box-shadow: 0 0 3px rgba(255,150,50,0.3); }
            50% { box-shadow: 0 0 6px rgba(255,150,50,0.5); }
        }
        @keyframes wickEmber {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* Wax drips */
        .wax-drip {
            position: absolute;
            width: 6px;
            background: linear-gradient(180deg,
                rgba(100,85,65,0.9),
                rgba(80,65,50,0.7)
            );
            border-radius: 0 0 3px 3px;
            animation: drip var(--dur) ease-in infinite var(--delay);
            opacity: 0;
        }
        @keyframes drip {
            0% { height: 0; opacity: 0; }
            10% { height: 5px; opacity: 0.8; }
            80% { opacity: 0.6; }
            100% { height: var(--len); opacity: 0; }
        }

        /* Candle base / holder */
        .candle-holder {
            width: 60px; height: 12px;
            margin: 0 auto;
            background: linear-gradient(90deg,
                rgba(40,30,25,0.6),
                rgba(70,55,45,0.8),
                rgba(40,30,25,0.6)
            );
            border-radius: 3px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        .candle-plate {
            width: 80px; height: 6px;
            margin: 2px auto 0;
            background: linear-gradient(90deg,
                rgba(35,25,20,0.5),
                rgba(60,48,38,0.7),
                rgba(35,25,20,0.5)
            );
            border-radius: 0 0 4px 4px;
        }

        /* â”€â”€â”€ SUB TEXT â”€â”€â”€ */
        .sub-text {
            font-family: 'Cinzel Decorative', serif;
            font-size: 10px;
            letter-spacing: 16px;
            color: rgba(180,160,130,0);
            margin-top: 30px;
            animation: textReveal 5s ease-out 2s forwards;
            z-index: 25;
        }
        @keyframes textReveal {
            to { color: rgba(180,160,130,0.15); }
        }

        /* â”€â”€â”€ OVERLAYS â”€â”€â”€ */
        .noise {
            position: fixed; inset: 0; z-index: 91; pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            background-size: 256px;
            animation: grain 0.4s steps(4) infinite;
        }
        @keyframes grain {
            0% { transform: translate(0); }
            25% { transform: translate(-1px,1px); }
            50% { transform: translate(1px,-1px); }
            75% { transform: translate(-1px,-1px); }
        }

        .vignette {
            position: fixed; inset: 0; z-index: 92; pointer-events: none;
            box-shadow:
                inset 0 0 400px rgba(0,0,0,1),
                inset 0 0 200px rgba(0,0,0,0.85),
                inset 0 0 80px rgba(0,0,0,0.6);
        }

        /* Fog layers */
        .fog {
            position: fixed; inset: 0; z-index: 3; pointer-events: none;
            animation: fog 35s ease-in-out infinite;
            opacity: 0;
        }
        .fog:nth-child(2) {
            background: radial-gradient(ellipse at 30% 65%, rgba(40,20,10,0.12) 0%, transparent 50%);
        }
        .fog:nth-child(3) {
            background: radial-gradient(ellipse at 70% 45%, rgba(25,12,8,0.1) 0%, transparent 45%);
            animation-delay: -12s;
        }
        @keyframes fog {
            0%, 100% { opacity: 0.3; transform: translateX(-15px); }
            50% { opacity: 0.7; transform: translateX(15px); }
        }

        /* â”€â”€â”€ VINE SVG PATHS (grow animation) â”€â”€â”€ */
        .vine-svg {
            position: fixed; inset: 0; z-index: 8; pointer-events: none;
        }
        .vine-path {
            fill: none;
            stroke: rgba(180,160,130,0.06);
            stroke-width: 0.8;
            stroke-dasharray: var(--len);
            stroke-dashoffset: var(--len);
            animation: vineGrow var(--dur) ease-out var(--delay) forwards;
        }
        .vine-leaf {
            fill: rgba(180,160,130,0.03);
            stroke: rgba(180,160,130,0.05);
            stroke-width: 0.3;
            opacity: 0;
            animation: leafAppear 2s ease-out var(--delay) forwards;
        }
        @keyframes vineGrow {
            to { stroke-dashoffset: 0; }
        }
        @keyframes leafAppear {
            to { opacity: 1; }
        }

        /* â”€â”€â”€ GOTHIC ORNAMENTAL CORNERS â”€â”€â”€ */
        .corner-orn {
            position: fixed; z-index: 9; pointer-events: none;
            opacity: 0;
            animation: fadeIn 4s ease-out var(--d) forwards;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* â”€â”€â”€ RUNES â”€â”€â”€ */
        .rune {
            position: fixed; z-index: 7; pointer-events: none;
            font-family: 'MedievalSharp', cursive;
            color: rgba(180,160,130,0);
            animation: runeGhost 18s ease-in-out infinite var(--d);
        }
        @keyframes runeGhost {
            0%, 100% { color: rgba(180,160,130,0); transform: translateY(0); }
            35% { color: rgba(180,160,130,0.05); transform: translateY(-10px); }
            65% { color: rgba(180,160,130,0.03); transform: translateY(-15px); }
        }

        /* â”€â”€â”€ WHISPER TEXTS â”€â”€â”€ */
        .whisper {
            position: fixed; z-index: 7; pointer-events: none;
            font-family: 'IM Fell English SC', serif;
            font-size: 9px; letter-spacing: 4px;
            color: rgba(180,160,130,0);
            animation: whisp 14s ease-in-out infinite var(--d);
        }
        @keyframes whisp {
            0%, 100% { color: rgba(180,160,130,0); }
            40% { color: rgba(180,160,130,0.05); transform: translateX(4px); }
        }

        /* â”€â”€â”€ BORDER FRAME â”€â”€â”€ */
        .frame {
            position: fixed; inset: 18px; z-index: 10; pointer-events: none;
            border: 0.5px solid rgba(180,160,130,0);
            animation: frameFade 5s ease-out 3s forwards;
        }
        .frame::before {
            content:''; position: absolute; inset: 5px;
            border: 0.5px solid rgba(180,160,130,0);
            animation: frameFade 5s ease-out 3.5s forwards;
        }
        @keyframes frameFade {
            to { border-color: rgba(180,160,130,0.035); }
        }

        /* â”€â”€â”€ SCAN LINE â”€â”€â”€ */
        .scanline {
            position: fixed; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(200,170,130,0.025), transparent);
            z-index: 30; pointer-events: none;
            animation: scan 18s ease-in-out infinite;
        }
        @keyframes scan {
            0% { top: -1px; opacity: 0; }
            3% { opacity: 1; }
            97% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* Dynamic light - flickers with the flame */
        .dyn-light {
            position: fixed; z-index: 2; pointer-events: none;
            border-radius: 50%;
            filter: blur(60px);
            animation: dynFlicker 3s ease-in-out infinite;
        }
        @keyframes dynFlicker {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            10% { opacity: 0.45; transform: scale(1.02); }
            30% { opacity: 0.25; transform: scale(0.98); }
            50% { opacity: 0.5; transform: scale(1.03); }
            70% { opacity: 0.3; transform: scale(0.97); }
            90% { opacity: 0.4; transform: scale(1.01); }
        }
    </style>
</head>
<body>
    <div class="bg"></div>
    <div class="cursor" id="cursor"></div>

    <!-- Fog -->
    <div class="fog"></div>
    <div class="fog"></div>

    <!-- Dynamic candlelight illumination -->
    <div class="dyn-light" style="top:30%;left:50%;width:600px;height:400px;margin-left:-300px;margin-top:-200px;background:radial-gradient(ellipse,rgba(120,55,15,0.06),transparent 70%);animation-duration:3s;"></div>
    <div class="dyn-light" style="top:35%;left:50%;width:350px;height:300px;margin-left:-175px;margin-top:-150px;background:radial-gradient(ellipse,rgba(150,70,20,0.04),transparent 65%);animation-duration:2.3s;animation-delay:-0.7s;"></div>
    <div class="dyn-light" style="top:25%;left:50%;width:800px;height:600px;margin-left:-400px;margin-top:-300px;background:radial-gradient(ellipse,rgba(80,30,10,0.03),transparent 60%);animation-duration:4.2s;animation-delay:-1.5s;"></div>

    <!-- Main canvas -->
    <canvas id="mainCanvas"></canvas>

    <!-- Gothic vine SVGs that grow in from corners -->
    <svg class="vine-svg" viewBox="0 0 1920 1080" preserveAspectRatio="xMidYMid slice">
        <!-- Top-left vine -->
        <path class="vine-path" d="M 0 200 Q 30 180 50 150 Q 70 120 60 80 Q 55 50 80 30 Q 110 10 140 25 Q 160 35 150 60" style="--len:350;--dur:8s;--delay:1s;"/>
        <path class="vine-path" d="M 0 200 Q 25 195 40 180 Q 60 160 55 130 Q 45 100 30 80" style="--len:200;--dur:6s;--delay:2s;"/>
        <path class="vine-path" d="M 80 30 Q 100 20 130 30 Q 150 40 160 70 Q 165 90 180 100 Q 200 110 220 100" style="--len:250;--dur:7s;--delay:3s;"/>
        <path class="vine-path" d="M 50 150 L 40 140 L 55 145" style="--len:30;--dur:2s;--delay:4s;"/>
        <path class="vine-path" d="M 60 80 L 48 72 L 58 78" style="--len:25;--dur:2s;--delay:5s;"/>
        <path class="vine-path" d="M 140 25 L 145 12 L 138 22" style="--len:25;--dur:2s;--delay:5.5s;"/>
        <ellipse class="vine-leaf" cx="30" cy="80" rx="6" ry="3" transform="rotate(-30 30 80)" style="--delay:6s;"/>
        <ellipse class="vine-leaf" cx="150" cy="60" rx="5" ry="2.5" transform="rotate(20 150 60)" style="--delay:7s;"/>

        <!-- Top-right vine -->
        <path class="vine-path" d="M 1920 180 Q 1890 165 1870 135 Q 1855 105 1865 70 Q 1875 40 1850 20 Q 1825 5 1795 18 Q 1775 28 1785 55" style="--len:340;--dur:8s;--delay:1.5s;"/>
        <path class="vine-path" d="M 1865 70 Q 1850 50 1830 45 Q 1810 42 1790 55 Q 1770 70 1750 65" style="--len:200;--dur:6s;--delay:3.5s;"/>
        <path class="vine-path" d="M 1870 135 L 1882 125 L 1872 130" style="--len:25;--dur:2s;--delay:4.5s;"/>
        <ellipse class="vine-leaf" cx="1790" cy="55" rx="5" ry="2.5" transform="rotate(-15 1790 55)" style="--delay:6.5s;"/>

        <!-- Bottom-left vine -->
        <path class="vine-path" d="M 0 880 Q 35 895 55 920 Q 75 950 65 985 Q 55 1010 80 1035 Q 100 1050 130 1040" style="--len:300;--dur:7s;--delay:2s;"/>
        <path class="vine-path" d="M 55 920 L 42 928 L 52 922" style="--len:25;--dur:2s;--delay:5s;"/>
        <ellipse class="vine-leaf" cx="80" cy="1035" rx="5" ry="3" transform="rotate(15 80 1035)" style="--delay:7s;"/>

        <!-- Bottom-right vine -->
        <path class="vine-path" d="M 1920 900 Q 1885 910 1865 940 Q 1848 970 1858 1000 Q 1870 1030 1845 1050 Q 1820 1065 1790 1055" style="--len:300;--dur:7s;--delay:2.5s;"/>
        <path class="vine-path" d="M 1865 940 L 1878 948 L 1868 942" style="--len:25;--dur:2s;--delay:5.5s;"/>
        <ellipse class="vine-leaf" cx="1845" cy="1050" rx="5" ry="2.5" transform="rotate(-20 1845 1050)" style="--delay:7.5s;"/>

        <!-- Center top ornament -->
        <g style="opacity:0;animation:fadeIn 6s ease-out 4s forwards;">
            <line x1="910" y1="0" x2="910" y2="55" stroke="rgba(180,160,130,0.04)" stroke-width="0.5" stroke-dasharray="1 3"/>
            <line x1="1010" y1="0" x2="1010" y2="55" stroke="rgba(180,160,130,0.04)" stroke-width="0.5" stroke-dasharray="1 3"/>
            <circle cx="960" cy="60" r="4" stroke="rgba(180,160,130,0.05)" fill="none" stroke-width="0.5"/>
            <line x1="956" y1="50" x2="960" y2="60" stroke="rgba(180,160,130,0.04)" stroke-width="0.4"/>
            <line x1="964" y1="50" x2="960" y2="60" stroke="rgba(180,160,130,0.04)" stroke-width="0.4"/>
            <path d="M 960 64 L 960 85" stroke="rgba(180,160,130,0.04)" stroke-width="0.5" stroke-dasharray="1 4"/>
            <circle cx="960" cy="88" r="2" stroke="rgba(180,160,130,0.04)" fill="none" stroke-width="0.4"/>
        </g>

        <line x1="150" y1="55" x2="860" y2="55" stroke="rgba(180,160,130,0.02)" stroke-width="0.3" stroke-dasharray="1 8" style="opacity:0;animation:fadeIn 5s ease-out 5s forwards;"/>
        <line x1="1060" y1="55" x2="1770" y2="55" stroke="rgba(180,160,130,0.02)" stroke-width="0.3" stroke-dasharray="1 8" style="opacity:0;animation:fadeIn 5s ease-out 5s forwards;"/>
    </svg>

    <!-- Corner ornamental crosses -->
    <div class="corner-orn" style="top:20px;left:20px;--d:2s;">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" stroke="rgba(180,160,130,0.045)" stroke-width="0.4">
            <line x1="25" y1="2" x2="25" y2="48"/>
            <line x1="2" y1="20" x2="48" y2="20"/>
            <circle cx="25" cy="20" r="7"/>
            <circle cx="25" cy="20" r="3" stroke-dasharray="1 2"/>
            <path d="M 25 2 L 27 7 L 25 5.5 L 23 7 Z"/>
        </svg>
    </div>
    <div class="corner-orn" style="top:20px;right:20px;--d:2.4s;">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" stroke="rgba(180,160,130,0.045)" stroke-width="0.4">
            <line x1="25" y1="2" x2="25" y2="48"/>
            <line x1="2" y1="20" x2="48" y2="20"/>
            <circle cx="25" cy="20" r="7"/>
            <path d="M 25 2 L 27 7 L 25 5.5 L 23 7 Z"/>
        </svg>
    </div>
    <div class="corner-orn" style="bottom:20px;left:20px;--d:2.8s;">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" stroke="rgba(180,160,130,0.045)" stroke-width="0.4">
            <line x1="25" y1="2" x2="25" y2="48"/>
            <line x1="2" y1="30" x2="48" y2="30"/>
            <circle cx="25" cy="30" r="5" stroke-dasharray="1 3"/>
        </svg>
    </div>
    <div class="corner-orn" style="bottom:20px;right:20px;--d:3.2s;">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" stroke="rgba(180,160,130,0.045)" stroke-width="0.4">
            <line x1="25" y1="2" x2="25" y2="48"/>
            <line x1="2" y1="30" x2="48" y2="30"/>
            <circle cx="25" cy="30" r="5" stroke-dasharray="1 3"/>
        </svg>
    </div>

    <!-- Frame -->
    <div class="frame"></div>

    <!-- Scanline -->
    <div class="scanline"></div>

    <!-- â”€â”€â”€ THE CANDLE & FLAME â”€â”€â”€ -->
    <div class="flame-stage">
        <div class="flame-container">
            <div class="flame-sizer" id="flameSizer">ğ”
                <div class="flame-letter flame-haze" id="fHaze">ğ”</div>
                <div class="flame-letter flame-outer" id="fOuter">ğ”</div>
                <div class="flame-letter flame-mid" id="fMid">ğ”</div>
                <div class="flame-letter flame-inner" id="fInner">ğ”</div>
                <div class="flame-letter flame-core" id="fCore">ğ”</div>
            </div>

            <div class="candle-body">
                <div class="candle-stick" id="candleStick">
                    <div class="wick"></div>
                </div>
                <div class="candle-holder"></div>
                <div class="candle-plate"></div>
            </div>
        </div>

        <div class="sub-text">lar.p</div>
    </div>

    <!-- Overlays -->
    <div class="noise"></div>
    <div class="vignette"></div>

    <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SETUP
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const C = document.getElementById('mainCanvas');
    const X = C.getContext('2d');
    let W, H;
    const resize = () => { W = C.width = innerWidth; H = C.height = innerHeight; };
    resize();
    addEventListener('resize', resize);

    let mx = W/2, my = H/2, tmx = W/2, tmy = H/2;
    addEventListener('mousemove', e => { tmx = e.clientX; tmy = e.clientY; });

    const cur = document.getElementById('cursor');
    addEventListener('mousemove', e => {
        cur.style.left = e.clientX + 'px';
        cur.style.top = e.clientY + 'px';
    });

    const getFlamePos = () => {
        const el = document.getElementById('flameSizer');
        if (!el) return { x: W/2, y: H/2 };
        const r = el.getBoundingClientRect();
        return { x: r.left + r.width / 2, y: r.top + r.height * 0.3 };
    };

    // Wax drips
    (function() {
        const stick = document.getElementById('candleStick');
        [
            { left: '-2px', delay: '0s', dur: '12s', len: '25px' },
            { right: '-2px', delay: '4s', dur: '15s', len: '30px' },
            { left: '8px', delay: '8s', dur: '10s', len: '20px' },
            { right: '6px', delay: '2s', dur: '18s', len: '35px' },
        ].forEach(s => {
            const d = document.createElement('div');
            d.className = 'wax-drip';
            d.style.top = '0';
            if (s.left) d.style.left = s.left;
            if (s.right) d.style.right = s.right;
            d.style.setProperty('--dur', s.dur);
            d.style.setProperty('--delay', s.delay);
            d.style.setProperty('--len', s.len);
            stick.appendChild(d);
        });
    })();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHAIN PHYSICS (Verlet)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Chain {
        constructor(ax, ay, links, linkLen, thick) {
            this.links = links;
            this.linkLen = linkLen;
            this.thick = thick;
            this.pts = [];
            this.old = [];
            this.phase = Math.random() * Math.PI * 2;
            this.freq = 0.25 + Math.random() * 0.4;
            this.amp = 0.25 + Math.random() * 0.35;

            for (let i = 0; i <= links; i++) {
                this.pts.push({ x: ax, y: ay + i * linkLen });
                this.old.push({ x: ax + (Math.random()-0.5)*2, y: ay + i * linkLen });
            }
        }

        update(t) {
            for (let i = 1; i < this.pts.length; i++) {
                const p = this.pts[i], o = this.old[i];
                const vx = (p.x - o.x) * 0.97;
                const vy = (p.y - o.y) * 0.97;
                o.x = p.x; o.y = p.y;
                p.x += vx;
                p.y += vy + 0.18;
                p.x += Math.sin(t * this.freq + this.phase + i * 0.6) * this.amp;
                // Mouse push
                const dx = p.x - mx, dy = p.y - my;
                const d = Math.sqrt(dx*dx+dy*dy);
                if (d < 120) { p.x += (dx/d)*2; p.y += (dy/d)*0.8; }
            }
            for (let iter = 0; iter < 6; iter++) {
                for (let i = 0; i < this.pts.length - 1; i++) {
                    const a = this.pts[i], b = this.pts[i+1];
                    const dx = b.x-a.x, dy = b.y-a.y;
                    const dist = Math.sqrt(dx*dx+dy*dy);
                    const diff = (this.linkLen - dist) / dist * 0.5;
                    const ox = dx*diff, oy = dy*diff;
                    if (i === 0) { b.x += ox*2; b.y += oy*2; }
                    else { a.x -= ox; a.y -= oy; b.x += ox; b.y += oy; }
                }
            }
        }

        draw(ctx) {
            for (let i = 0; i < this.pts.length - 1; i++) {
                const a = this.pts[i], b = this.pts[i+1];
                const mx2 = (a.x+b.x)/2, my2 = (a.y+b.y)/2;
                const angle = Math.atan2(b.y-a.y, b.x-a.x);
                const w = this.linkLen * 0.75, h = this.thick;

                ctx.save();
                ctx.translate(mx2, my2);
                ctx.rotate(angle);

                // Link outer
                ctx.strokeStyle = `rgba(170,150,125,${0.15 + i*0.008})`;
                ctx.lineWidth = 1.2;
                ctx.beginPath();
                ctx.ellipse(0, 0, w/2, h/2, 0, 0, Math.PI*2);
                ctx.stroke();

                // Specular highlight
                ctx.strokeStyle = `rgba(220,200,170,${0.05})`;
                ctx.lineWidth = 0.5;
                ctx.beginPath();
                ctx.ellipse(0, -h*0.18, w*0.3, h*0.15, 0, 0, Math.PI);
                ctx.stroke();

                ctx.restore();
            }

            // End ornament
            const last = this.pts[this.pts.length - 1];
            ctx.save();
            ctx.translate(last.x, last.y);
            ctx.rotate(Math.PI/4);
            ctx.strokeStyle = 'rgba(180,160,130,0.12)';
            ctx.lineWidth = 0.8;
            ctx.strokeRect(-6,-6,12,12);
            ctx.strokeStyle = 'rgba(180,160,130,0.06)';
            ctx.lineWidth = 0.5;
            ctx.strokeRect(-3.5,-3.5,7,7);
            ctx.restore();

            // Tiny glow at bottom
            const g = ctx.createRadialGradient(last.x,last.y,0,last.x,last.y,8);
            g.addColorStop(0,'rgba(180,160,130,0.03)');
            g.addColorStop(1,'rgba(180,160,130,0)');
            ctx.fillStyle = g;
            ctx.beginPath();
            ctx.arc(last.x,last.y,8,0,Math.PI*2);
            ctx.fill();
        }
    }

    const chains = [
        new Chain(W*0.06, -5, 6, 16, 6),
        new Chain(W*0.14, -5, 8, 14, 5.5),
        new Chain(W*0.24, -5, 5, 18, 7),
        new Chain(W*0.35, -5, 7, 15, 5.5),
        new Chain(W*0.48, -5, 4, 20, 7.5),
        new Chain(W*0.52, -5, 4, 20, 7.5),
        new Chain(W*0.65, -5, 7, 15, 5.5),
        new Chain(W*0.76, -5, 5, 18, 7),
        new Chain(W*0.86, -5, 8, 14, 5.5),
        new Chain(W*0.94, -5, 6, 16, 6),
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FIRE PARTICLES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Fire {
        constructor() { this.reset(); }
        reset() {
            const fp = getFlamePos();
            this.x = fp.x + (Math.random()-0.5)*40;
            this.y = fp.y + (Math.random()-0.5)*25;
            this.sz = Math.random()*4+1;
            this.vy = -(Math.random()*1.8+0.5);
            this.vx = (Math.random()-0.5)*0.8;
            this.life = Math.random()*80+40;
            this.age = 0;
            this.ws = Math.random()*0.08+0.03;
            this.wa = Math.random()*15+5;
            this.sx = this.x;
            this.g = Math.floor(Math.random()*120+100);
            this.b = Math.floor(Math.random()*30);
        }
        update() {
            this.age++;
            this.y += this.vy;
            this.x = this.sx + Math.sin(this.age*this.ws)*this.wa;
            this.sx += this.vx*0.2;
            this.sz *= 0.994;
            if (this.age >= this.life) this.reset();
        }
        draw(c) {
            const a = this.age/this.life;
            let op = a<0.1?a/0.1:a>0.5?(1-a)/0.5:1;
            op *= 0.6;
            const g = c.createRadialGradient(this.x,this.y,0,this.x,this.y,this.sz*2.5);
            g.addColorStop(0,`rgba(255,${this.g},${this.b},${op})`);
            g.addColorStop(0.4,`rgba(${180},${this.g*0.4|0},${this.b},${op*0.4})`);
            g.addColorStop(1,`rgba(100,10,0,0)`);
            c.beginPath();
            c.arc(this.x,this.y,this.sz*2.5,0,Math.PI*2);
            c.fillStyle = g;
            c.fill();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SMOKE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Smoke {
        constructor() { this.reset(); }
        reset() {
            const fp = getFlamePos();
            this.x = fp.x + (Math.random()-0.5)*20;
            this.y = fp.y - 30;
            this.sz = Math.random()*18+8;
            this.vy = -(Math.random()*0.35+0.1);
            this.vx = (Math.random()-0.5)*0.15;
            this.life = Math.random()*500+300;
            this.age = 0;
            this.gr = Math.random()*0.08+0.03;
        }
        update() {
            this.age++;
            this.y += this.vy;
            this.x += this.vx + Math.sin(this.age*0.004)*0.15;
            this.sz += this.gr;
            if (this.age >= this.life) this.reset();
        }
        draw(c) {
            const a = this.age/this.life;
            let op = a<0.15?(a/0.15)*0.03:a>0.5?((1-a)/0.5)*0.03:0.03;
            const g = c.createRadialGradient(this.x,this.y,0,this.x,this.y,this.sz);
            g.addColorStop(0,`rgba(50,40,35,${op})`);
            g.addColorStop(1,'rgba(50,40,35,0)');
            c.beginPath();
            c.arc(this.x,this.y,this.sz,0,Math.PI*2);
            c.fillStyle = g;
            c.fill();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MOTHS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Moth {
        constructor() {
            this.ang = Math.random()*Math.PI*2;
            this.dist = 80+Math.random()*120;
            this.spd = (Math.random()*0.008+0.003)*(Math.random()>0.5?1:-1);
            this.wingPh = Math.random()*Math.PI*2;
            this.wingSpd = Math.random()*0.15+0.08;
            this.sz = Math.random()*3+2;
            this.yOff = (Math.random()-0.5)*60;
            this.wobFreq = Math.random()*0.03+0.01;
        }
        update(t) {
            this.ang += this.spd;
            this.wingPh += this.wingSpd;
            if (Math.random()<0.002) this.spd *= -1;
            this.dist += Math.sin(t*this.wobFreq)*0.5;
            this.dist = Math.max(60, Math.min(200, this.dist));
        }
        draw(c) {
            const fp = getFlamePos();
            const x = fp.x + Math.cos(this.ang)*this.dist;
            const y = fp.y + Math.sin(this.ang)*this.dist*0.6 + this.yOff;
            const ws = Math.abs(Math.sin(this.wingPh))*this.sz;
            const ma = this.ang + Math.PI/2*Math.sign(this.spd);
            c.save();
            c.translate(x,y);
            c.rotate(ma);
            c.fillStyle = 'rgba(70,55,45,0.35)';
            c.beginPath();
            c.ellipse(0,0,1,this.sz*0.7,0,0,Math.PI*2);
            c.fill();
            c.fillStyle = 'rgba(110,90,70,0.18)';
            c.beginPath();
            c.ellipse(-ws,-1,ws*0.8,this.sz*0.5,-0.3,0,Math.PI*2);
            c.fill();
            c.beginPath();
            c.ellipse(ws,-1,ws*0.8,this.sz*0.5,0.3,0,Math.PI*2);
            c.fill();
            c.restore();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DUST MOTES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Dust {
        constructor(){this.reset();}
        reset(){
            this.x=Math.random()*W;this.y=Math.random()*H;
            this.sz=Math.random()*1.2+0.2;
            this.vx=(Math.random()-0.5)*0.1;this.vy=-(Math.random()*0.15+0.03);
            this.maxOp=Math.random()*0.2+0.03;this.life=Math.random()*600+300;this.age=0;
        }
        update(){
            this.x+=this.vx;this.y+=this.vy;this.age++;
            const dx=this.x-mx,dy=this.y-my,d=Math.sqrt(dx*dx+dy*dy);
            if(d<100){this.x+=dx/d*0.4;this.y+=dy/d*0.4;}
            if(this.age>=this.life||this.y<-10)this.reset();
        }
        draw(c){
            const r=this.age/this.life;
            let op=r<0.15?r/0.15:r>0.8?(1-r)/0.2:1;
            c.beginPath();c.arc(this.x,this.y,this.sz,0,Math.PI*2);
            c.fillStyle=`rgba(200,180,150,${op*this.maxOp})`;c.fill();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ROSE PETALS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Petal {
        constructor(){this.reset(true);}
        reset(init){
            this.x=Math.random()*W;this.y=init?Math.random()*H:-10;
            this.sz=Math.random()*4+2;
            this.vy=Math.random()*0.4+0.15;this.vx=(Math.random()-0.5)*0.2;
            this.rot=Math.random()*Math.PI*2;this.rotSpd=(Math.random()-0.5)*0.02;
            this.wb=Math.random()*0.015;this.wbA=Math.random()*40;
            this.sx=this.x;this.age=0;this.op=Math.random()*0.08+0.02;
        }
        update(){
            this.age++;this.y+=this.vy;
            this.x=this.sx+Math.sin(this.age*this.wb)*this.wbA;
            this.rot+=this.rotSpd;if(this.y>H+20)this.reset(false);
        }
        draw(c){
            c.save();c.translate(this.x,this.y);c.rotate(this.rot);
            c.fillStyle=`rgba(100,20,25,${this.op})`;
            c.beginPath();
            c.moveTo(0,-this.sz);
            c.bezierCurveTo(this.sz,-this.sz*0.5,this.sz,this.sz*0.5,0,this.sz);
            c.bezierCurveTo(-this.sz,this.sz*0.5,-this.sz,-this.sz*0.5,0,-this.sz);
            c.fill();c.restore();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // EMBERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Ember {
        constructor(){this.reset();}
        reset(){
            const fp=getFlamePos();
            this.x=fp.x+(Math.random()-0.5)*30;this.y=fp.y;
            this.sz=Math.random()*1.5+0.3;
            this.vy=-(Math.random()*1.2+0.3);this.vx=(Math.random()-0.5)*0.5;
            this.life=Math.random()*120+60;this.age=0;
        }
        update(){
            this.age++;this.y+=this.vy;
            this.x+=this.vx+Math.sin(this.age*0.05)*0.3;
            this.vy*=0.995;if(this.age>=this.life)this.reset();
        }
        draw(c){
            const a=this.age/this.life;
            let op=a<0.1?a/0.1:a>0.6?(1-a)/0.4:1;op*=0.7;
            c.beginPath();c.arc(this.x,this.y,this.sz,0,Math.PI*2);
            c.fillStyle=`rgba(255,${140-a*100|0},${20-a*20|0},${op})`;c.fill();
            c.beginPath();c.arc(this.x,this.y,this.sz*3,0,Math.PI*2);
            c.fillStyle=`rgba(255,100,20,${op*0.1})`;c.fill();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LIGHT RAYS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Ray {
        constructor(){
            this.ang=Math.random()*Math.PI*2;
            this.len=H*(Math.random()*0.35+0.2);
            this.w=Math.random()*1.2+0.3;
            this.maxOp=Math.random()*0.012+0.003;
            this.spd=Math.random()*0.001+0.0003;
            this.ph=Math.random()*Math.PI*2;
        }
        update(){this.ph+=this.spd;}
        draw(c){
            const fp=getFlamePos();
            const op=(Math.sin(this.ph)*0.5+0.5)*this.maxOp;
            c.save();c.translate(fp.x,fp.y);c.rotate(this.ang);
            const g=c.createLinearGradient(0,0,0,this.len);
            g.addColorStop(0,`rgba(200,140,80,${op})`);
            g.addColorStop(1,'rgba(200,140,80,0)');
            c.fillStyle=g;c.fillRect(-this.w/2,0,this.w,this.len);
            c.restore();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FALLING ASH
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    class Ash {
        constructor(){this.reset(true);}
        reset(init){
            this.x=Math.random()*W;this.y=init?Math.random()*H:-5;
            this.sz=Math.random()*0.8+0.2;
            this.vy=Math.random()*0.25+0.08;
            this.rot=Math.random()*Math.PI*2;this.rotS=(Math.random()-0.5)*0.015;
            this.op=Math.random()*0.08+0.015;
            this.wb=Math.random()*0.012;this.wbA=Math.random()*25;
            this.sx=this.x;this.age=0;
        }
        update(){
            this.age++;this.y+=this.vy;
            this.x=this.sx+Math.sin(this.age*this.wb)*this.wbA;
            this.rot+=this.rotS;if(this.y>H+10)this.reset(false);
        }
        draw(c){
            c.save();c.translate(this.x,this.y);c.rotate(this.rot);
            c.fillStyle=`rgba(140,120,100,${this.op})`;
            c.fillRect(-this.sz/2,-this.sz/2,this.sz,this.sz*0.6);
            c.restore();
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INSTANTIATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const fires = Array.from({length:40},()=>new Fire());
    const smokes = Array.from({length:12},()=>new Smoke());
    const moths = Array.from({length:6},()=>new Moth());
    const dusts = Array.from({length:55},()=>new Dust());
    const petals = Array.from({length:12},()=>new Petal());
    const embers = Array.from({length:25},()=>new Ember());
    const rays = Array.from({length:14},()=>new Ray());
    const ashes = Array.from({length:25},()=>new Ash());

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FLAME LETTER ANIMATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const fCore=document.getElementById('fCore');
    const fInner=document.getElementById('fInner');
    const fMid=document.getElementById('fMid');
    const fOuter=document.getElementById('fOuter');
    const fHaze=document.getElementById('fHaze');
    const FL=[
        {el:fCore, amp:1.5,freq:1.1,skA:0.8,scA:0.005},
        {el:fInner,amp:2.5,freq:0.9,skA:1.2,scA:0.01},
        {el:fMid,  amp:3.5,freq:0.7,skA:1.8,scA:0.015},
        {el:fOuter,amp:5,  freq:0.5,skA:2.5,scA:0.02},
        {el:fHaze, amp:7,  freq:0.35,skA:3, scA:0.025},
    ];

    function animFlame(time){
        const t=time*0.001;
        FL.forEach((l,i)=>{
            const n1=Math.sin(t*l.freq*3.7+i)*0.5+Math.sin(t*l.freq*5.3+i*2)*0.3+Math.sin(t*l.freq*7.1+i*0.5)*0.2;
            const n2=Math.sin(t*l.freq*2.9+i*3)*0.4+Math.cos(t*l.freq*4.1+i)*0.3;
            const tx=n1*l.amp;
            const sk=n2*l.skA;
            const sy=1+n1*l.scA;
            const sx=1+n2*l.scA*0.5;
            l.el.style.transform=`translateX(${tx}px) skewX(${sk}deg) scaleX(${sx}) scaleY(${sy})`;
        });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RUNES & WHISPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const runeChars='áš áš¢áš¦áš¨áš±áš²áš·áš¹ášºáš¾á›á›ƒá›‡á›ˆá›‰á›Šá›á›’á›–á›—á›šá›œá›á›Ÿ';
    for(let i=0;i<16;i++){
        const r=document.createElement('div');r.className='rune';
        r.textContent=runeChars[Math.floor(Math.random()*runeChars.length)];
        r.style.left=(5+Math.random()*90)+'%';
        r.style.top=(10+Math.random()*80)+'%';
        r.style.fontSize=(10+Math.random()*8)+'px';
        r.style.setProperty('--d',(Math.random()*18)+'s');
        document.body.appendChild(r);
    }

    ['memento mori','in tenebris','vanitas vanitatum','et in arcadia ego','sic transit gloria','lux aeterna'].forEach((t,i)=>{
        const el=document.createElement('div');el.className='whisper';
        el.textContent=t;
        el.style.top=(12+Math.random()*75)+'%';
        el.style.left=(5+Math.random()*85)+'%';
        el.style.setProperty('--d',(i*3.5+Math.random()*4)+'s');
        document.body.appendChild(el);
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAIN LOOP
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function loop(ts){
        const t=ts||0;
        X.clearRect(0,0,W,H);
        mx+=(tmx-mx)*0.04;my+=(tmy-my)*0.04;
        const ct=t*0.001;

        rays.forEach(r=>{r.update();r.draw(X);});
        smokes.forEach(s=>{s.update();s.draw(X);});
        ashes.forEach(a=>{a.update();a.draw(X);});
        petals.forEach(p=>{p.update();p.draw(X);});
        dusts.forEach(d=>{d.update();d.draw(X);});
        chains.forEach(c=>{c.update(ct);c.draw(X);});
        fires.forEach(f=>{f.update();f.draw(X);});
        embers.forEach(e=>{e.update();e.draw(X);});
        moths.forEach(m=>{m.update(ct);m.draw(X);});
        animFlame(t);

        requestAnimationFrame(loop);
    }
    loop();

    addEventListener('resize',()=>{
        const pos=[0.06,0.14,0.24,0.35,0.48,0.52,0.65,0.76,0.86,0.94];
        chains.forEach((c,i)=>{c.pts[0].x=W*pos[i];c.old[0].x=W*pos[i];});
    });
    </script>
</body>
</html>
